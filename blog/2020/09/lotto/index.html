<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Lotto</title>
        <link rel="stylesheet" href="../../../../asset/style/template.css" />
        <style>
            #divContainer {
                padding-top: 16px;
            }
            .lottery {
                margin-bottom: 16px;
                margin-left: 16px;
            }
            .ball {
                display: inline-block;
                width: 40px;
                height: 40px;
                border-radius: 40px;
                background-color: beige;
                text-align: center;
                line-height: 40px;
                color: #fff;
                margin-left: 8px;
            }
            .red,
            .blue {
                display: inline-block;
                margin: 0;
            }
            .red .ball {
                background-color: red;
            }
            .blue .ball {
                background-color: blue;
            }
            .btn {
                width: 80px;
                height: 32px;
                font-size: 18px;
                text-align: center;
                line-height: 20px;
                border-radius: 4px;
                background-color: orange;
                color: #000;
                padding: 0;
                outline: none;
            }
        </style>
    </head>
    <body>
        <div id="divContainer" class="iframe-box">
            <div class="lottery" id="DuotoneBall">
                <span>双色球</span>
                <div class="red"></div>
                <div class="blue"></div>
                <button class="btn" lottery-type="DuotoneBall">机选</button>
            </div>

            <div class="lottery" id="SuperLotto">
                <span>大乐透</span>
                <div class="red"></div>
                <div class="blue"></div>
                <button class="btn" lottery-type="SuperLotto">机选</button>
            </div>
        </div>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/lib-r-math.js@1.0.86/dist/lib/libR.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
    <script>
        // FIXME: 数字重复，相似度有点高
        const libR = window.libR;
        const LotteryType = {
            DuotoneBall: 'DuotoneBall',
            SuperLotto: 'SuperLotto',
        };
        const {
            Normal,
            rng: {
                SuperDuper,
                normal: { AhrensDieter },
            },
            R: { numberPrecision, multiplex, seq: _seq },
        } = libR;

        console.log(libR);

        const norm1 = Normal(
            new AhrensDieter(new SuperDuper(Date.now().valueOf()))
        );
        const norm2 = Normal();
        const { rnorm, dnorm, pnorm, qnorm } = norm1;
        const seq = _seq()();
        const _9 = numberPrecision(9); //9 digit significance

        function DuotoneBall() {
            const q = seq(-1, 1);
            const r1 = _9(rnorm(6, 17, 5.5));
            const r2 = _9(rnorm(1, 8.5, 2.6));
            $('#DuotoneBall')
                .children('.red')
                .first()
                .html(
                    r1
                        .map(
                            (val) =>
                                `<div class="ball">${Math.round(val)}</div>`
                        )
                        .join('')
                );
            $('#DuotoneBall')
                .children('.blue')
                .first()
                .html(`<div class="ball">${Math.round(r2)}</div>`);
        }

        function SuperLotto() {
            const q = seq(-1, 1);
            const r1 = _9(rnorm(5, 18, 6));
            const r2 = _9(rnorm(2, 6.5, 2.16));
            $('#SuperLotto')
                .children('.red')
                .first()
                .html(
                    r1
                        .map(
                            (val) =>
                                `<div class="ball">${Math.round(val)}</div>`
                        )
                        .join('')
                );
            $('#SuperLotto')
                .children('.blue')
                .first()
                .html(
                    r2
                        .map(
                            (val) =>
                                `<div class="ball">${Math.round(val)}</div>`
                        )
                        .join('')
                );
        }

        $('.btn').bind('click', function (event) {
            event.stopPropagation();
            console.log('click', event);
            const lotteryType = event.currentTarget.getAttribute(
                'lottery-type'
            );
            console.log(lotteryType);
            switch (lotteryType) {
                case LotteryType.DuotoneBall:
                    {
                        DuotoneBall();
                    }
                    break;
                case LotteryType.SuperLotto:
                    {
                        SuperLotto();
                    }
                    break;
                default:
                    break;
            }
        });

        DuotoneBall();
        SuperLotto();
    </script>
</html>
